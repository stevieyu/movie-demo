<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />

    <title>Video.js player with hls.js engine and P2P demo</title>

    <script src="https://unpkg.com/p2p-media-loader-core@0.6.2/build/p2p-media-loader-core.min.js"></script>
    <script src="https://unpkg.com/p2p-media-loader-hlsjs@0.6.2/build/p2p-media-loader-hlsjs.min.js"></script>

    <link href="https://unpkg.com/video.js@7.21.5/dist/video-js.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/video.js@7.21.5/dist/video.min.js"></script>

    <script src="https://unpkg.com/videojs-contrib-hls.js@3.2.0/dist/videojs-contrib-hlsjs.min.js"></script>

    <style>
        #video {
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
    </style>
</head>
<body>
<video id="video" class="video-js vjs-default-skin vjs-big-play-centered vjs-fluid" preload="none" autoplay controls></video>

<script>
  if (p2pml.hlsjs.Engine.isSupported()) {
    //https://github.com/Novage/p2p-media-loader/blob/master/FAQ.md
    var engine = new p2pml.hlsjs.Engine({
      loader: {
        trackerAnnounce: [
          "wss://bittorrent-tracker.zeabur.app",
        ],
        // rtcConfig: {
        //   iceServers: [
        //     { urls: "stun:stun.l.google.com:19302" },
        //     { urls: "stun:global.stun.twilio.com:3478?transport=udp" }
        //   ]
        // }
      }
    });

    engine.on("peer_connect", peer => console.log("peer_connect", peer.id, peer.remoteAddress));
    engine.on("peer_close", peerId => console.log("peer_close", peerId));
    engine.on("segment_loaded", (segment, peerId) => console.log("segment_loaded from", peerId ? `peer ${peerId}` : "HTTP"));


    var player = videojs("video", {
      html5: {
        hlsjsConfig: {
          liveSyncDurationCount: 7, // To have at least 7 segments in queue
          loader: engine.createLoaderClass(),
        },
      },
    });

    p2pml.hlsjs.initVideoJsContribHlsJsPlayer(player);

    player.src({
      src: "https://hono.dgcf.link/s5.bfzycdn.com/video/feichangxiaotewudajuezhan/HD/index.m3u8",
      type: "application/x-mpegURL",
    });

    player.ready(function () {
      player.volume(0.01); // 1%
    });
  } else {
    document.write("Not supported :(");
  }
</script>
</body>
</html>